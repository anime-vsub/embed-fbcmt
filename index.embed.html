<!doctype html>
<html>

  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  </head>

  <body>
    Embed Facebook Comment Plugin:
    <iframe id="embed" src="http://localhost:5173?href=https://google.com"></iframe>
    
    <script>
        const embed = document.querySelector("#embed")
        
        function setPropValue(el, prop, value) {
          return new Promise((resolve, reject) => {
            const handler = (event) => {
              if (event.data?.type === "res::fb:set_value") {
                const { code,  data } = event.data
                
                if (code.startsWith("success.")) resolve()
                else if (code.startsWith("error.")) reject(Object.assign(new Error(code), { prop: data }))
                else console.warn("[res::fb:set_value]: invalid code error '%s'", code);
             
                window.removeEventListener("message", handler)
              }
            }
            
            window.addEventListener("message", handler)
            el.contentWindow.postMessage({
              type: "req::fb:set_value",
              prop,
              val: value,
            }, "*")
          })
        }
        function listenEvent(el, cb) {
          window.addEventListener("message", event => {
            if (event.source !== el.contentWindow ) return
            if (event.data?.type !== "emit::fb_embed") return
            
                const typeCode = getTypeCode(event.data.code)
                
                if (!typeCode) return
                
                cb({
                  type: typeCode,
                  code: event.data.code,
                  data: event.data.data
                })
          })
        }
        
        listenEvent(embed, ev => {
          console.log(ev)
        })
        
        function getTypeCode(code) {
          if (code.startsWith("success.")) return "success"
          if (code.startsWith("loading.")) return "loading"
          if (code.startsWith("error.")  ) return "error"
          
          return null 
        }
    </script>
    
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      iframe {
        width: 100%;
        height: 350px;
        border: 0px;
      }
    </style>
  </body>

</html>